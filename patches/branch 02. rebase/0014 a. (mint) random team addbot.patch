Index: code/game/g_bot.c
===================================================================
--- code/game/g_bot.c	(revision 3372)
+++ code/game/g_bot.c	(working copy)
@@ -28,7 +28,12 @@
 static int		g_numBots;
 static char		*g_botInfos[MAX_BOTS];
 
+#ifdef MISSIONPACK
+static int		g_numTeamBots;
+static char		*g_teamBotInfos[MAX_BOTS];
+#endif
 
+
 int				g_numArenas;
 static char		*g_arenaInfos[MAX_ARENAS];
 
@@ -268,23 +273,36 @@
 Get random least used bot info on team or whole server if team is -1.
 ===============
 */
-int G_SelectRandomBotInfo( int team ) {
+char *G_SelectRandomBotInfo( int team ) {
 	int		selection[MAX_BOTS];
 	int		n, num;
 	int		count, bestCount;
 	char	*value;
+	int		numBots;
+	char	**botInfos;
 
+#ifdef MISSIONPACK
+	if ( g_gametype.integer >= GT_TEAM ) {
+		numBots = g_numTeamBots;
+		botInfos = g_teamBotInfos;
+	} else
+#endif
+	{
+		numBots = g_numBots;
+		botInfos = g_botInfos;
+	}
+
 	// don't add duplicate bots to the server if there are less bots than bot types
-	if ( team != -1 && G_CountBotPlayersByName( NULL, -1 ) < g_numBots ) {
+	if ( team != -1 && G_CountBotPlayersByName( NULL, -1 ) < numBots ) {
 		team = -1;
 	}
 
 	num = 0;
 	bestCount = MAX_CLIENTS;
-	for ( n = 0; n < g_numBots ; n++ ) {
-		value = Info_ValueForKey( g_botInfos[n], "funname" );
+	for ( n = 0; n < numBots ; n++ ) {
+		value = Info_ValueForKey( botInfos[n], "funname" );
 		if ( !value[0] ) {
-			value = Info_ValueForKey( g_botInfos[n], "name" );
+			value = Info_ValueForKey( botInfos[n], "name" );
 		}
 		//
 		count = G_CountBotPlayersByName( value, team );
@@ -305,10 +323,10 @@
 
 	if ( num > 0 ) {
 		num = random() * ( num - 1 );
-		return selection[num];
+		return botInfos[selection[num]];
 	}
 
-	return -1;
+	return NULL;
 }
 
 /*
@@ -583,7 +601,6 @@
 static void G_AddBot( const char *name, float skill, const char *team, int delay, char *altname) {
 	int				clientNum;
 	int				teamNum;
-	int				botinfoNum;
 	char			*botinfo;
 	char			*key;
 	char			*s;
@@ -631,15 +648,13 @@
 			teamNum = TEAM_FREE;
 		}
 
-		botinfoNum = G_SelectRandomBotInfo( teamNum );
+		botinfo = G_SelectRandomBotInfo( teamNum );
 
-		if ( botinfoNum < 0 ) {
+		if ( !botinfo ) {
 			G_Printf( S_COLOR_RED "Error: Cannot add random bot, no bot info available.\n" );
 			trap_BotFreeClient( clientNum );
 			return;
 		}
-
-		botinfo = G_GetBotInfoByNumber( botinfoNum );
 	}
 	else {
 		botinfo = G_GetBotInfoByName( name );
@@ -1005,8 +1020,142 @@
 	return NULL;
 }
 
+
+#ifdef MISSIONPACK
 /*
 ===============
+Character_Parse
+===============
+*/
+static qboolean Character_Parse(char **p, const char *filename) {
+	char *token;
+	char name[MAX_NAME_LENGTH];
+
+	token = COM_ParseExt(p, qtrue);
+
+	if ( token[0] != '{' ) {
+		return qfalse;
+	}
+
+	while ( 1 ) {
+		token = COM_ParseExt(p, qtrue);
+
+		if (Q_stricmp(token, "}") == 0) {
+			return qtrue;
+		}
+
+		if (!token[0]) {
+			return qfalse;
+		}
+
+		if (token[0] == '{') {
+			// two tokens per line, character name and sex
+			token = COM_ParseExt(p, qtrue);
+			if ( !token[0] ) {
+				return qfalse;
+			}
+			Q_strncpyz( name, token, sizeof( name ) );
+
+			token = COM_ParseExt(p, qtrue);
+			if ( !token[0] ) {
+				return qfalse;
+			}
+
+			if ( g_numTeamBots < ARRAY_LEN( g_teamBotInfos ) ) {
+				g_teamBotInfos[g_numTeamBots] = G_GetBotInfoByName( name );
+				if ( g_teamBotInfos[g_numTeamBots] ) {
+					g_numTeamBots++;
+				} else {
+					G_Printf( S_COLOR_YELLOW "WARNING: No bot defined in bots.txt for character '%s' in %s.\n", name, filename );
+				}
+			}
+
+			token = COM_ParseExt(p, qtrue);
+			if (token[0] != '}') {
+				return qfalse;
+			}
+		}
+	}
+
+	return qfalse;
+}
+
+/*
+===============
+G_ParseTeamInfo
+
+Team Arena's addbot menu only allows adding characters from teaminfo.txt
+in g_gametypes >= GT_TEAM, so use them for random bot selection too.
+===============
+*/
+static void G_ParseTeamInfo( const char *filename ) {
+	int				len;
+	fileHandle_t	f;
+	char			buf[MAX_BOTS_TEXT];
+	char			*p, *token;
+
+	g_numTeamBots = 0;
+
+	if ( g_gametype.integer < GT_TEAM ) {
+		return;
+	}
+
+	len = trap_FS_FOpenFile( filename, &f, FS_READ );
+	if ( !f ) {
+		trap_Print( va( S_COLOR_RED "file not found: %s\n", filename ) );
+		return;
+	}
+	if ( len >= MAX_BOTS_TEXT ) {
+		trap_Print( va( S_COLOR_RED "file too large: %s is %i, max allowed is %i\n", filename, len, MAX_BOTS_TEXT ) );
+		trap_FS_FCloseFile( f );
+		return;
+	}
+
+	trap_FS_Read( buf, len, f );
+	buf[len] = 0;
+	trap_FS_FCloseFile( f );
+
+	p = buf;
+
+	while ( 1 ) {
+		token = COM_ParseExt( &p, qtrue );
+		if(!token[0] || token[0] == '}') {
+			break;
+		}
+
+		if ( Q_stricmp( token, "}" ) == 0 ) {
+			break;
+		}
+
+		if (Q_stricmp(token, "teams") == 0) {
+			if (SkipBracedSection(&p, 0)) {
+				continue;
+			} else {
+				break;
+			}
+		}
+
+		if (Q_stricmp(token, "characters") == 0) {
+			if (Character_Parse(&p, filename)) {
+				continue;
+			} else {
+				break;
+			}
+		}
+
+		if (Q_stricmp(token, "aliases") == 0) {
+			if (SkipBracedSection(&p, 0)) {
+				continue;
+			} else {
+				break;
+			}
+		}
+	}
+}
+#endif
+
+/*
+===============
 G_InitBots
 ===============
 */
@@ -1021,6 +1170,9 @@
 
 	G_LoadBots();
 	G_LoadArenas();
+#ifdef MISSIONPACK
+	G_ParseTeamInfo( "teaminfo.txt" );
+#endif
 
 	trap_Cvar_Register( &bot_minplayers, "bot_minplayers", "0", CVAR_SERVERINFO );
 
Index: code/ui/ui_main.c
===================================================================
--- code/ui/ui_main.c	(revision 3372)
+++ code/ui/ui_main.c	(working copy)
@@ -1169,7 +1169,8 @@
 static void UI_DrawTeamMember(rectDef_t *rect, float scale, vec4_t color, qboolean blue, int num, int textStyle) {
 	// 0 - None
 	// 1 - Human
-	// 2..NumCharacters - Bot
+	// 2 - Random Bot
+	// 3..NumCharacters - Bot
 	int value = trap_Cvar_VariableValue(va(blue ? "ui_blueteam%i" : "ui_redteam%i", num));
 	const char *text;
 	if (value <= 0) {
@@ -1176,8 +1177,10 @@
 		text = "Closed";
 	} else if (value == 1) {
 		text = "Human";
+	} else if (value == 2) {
+		text = "Random Bot";
 	} else {
-		value -= 2;
+		value -= 3;
 
 		if (ui_actualNetGameType.integer >= GT_TEAM) {
 			if (value >= uiInfo.characterCount) {
@@ -1746,13 +1749,17 @@
 }
 
 static void UI_DrawBotName(rectDef_t *rect, float scale, vec4_t color, int textStyle) {
+	// 0 - Random Bot
+	// 1..NumCharacters - Bot
 	int value = uiInfo.botIndex;
 	int game = trap_Cvar_VariableValue("g_gametype");
-	const char *text;
-	if (game >= GT_TEAM) {
-		text = uiInfo.characterList[value].name;
+	const char *text = "";
+	if (value == 0) {
+		text = "Random Bot";
+	} else if (game >= GT_TEAM) {
+		text = uiInfo.characterList[value-1].name;
 	} else {
-		text = UI_GetBotNameByNumber(value);
+		text = UI_GetBotNameByNumber(value-1);
 	}
   Text_Paint(rect->x, rect->y, scale, color, text, 0, 0, textStyle);
 }
@@ -2441,7 +2448,8 @@
 	if (select != 0) {
 		// 0 - None
 		// 1 - Human
-		// 2..NumCharacters - Bot
+		// 2 - Random Bot
+		// 3..NumCharacters - Bot
 		char *cvar = va(blue ? "ui_blueteam%i" : "ui_redteam%i", num);
 		int value = trap_Cvar_VariableValue(cvar);
 
@@ -2448,16 +2456,16 @@
 		value += select;
 
 		if (ui_actualNetGameType.integer >= GT_TEAM) {
-			if (value >= uiInfo.characterCount + 2) {
+			if (value >= uiInfo.characterCount + 3) {
 				value = 0;
 			} else if (value < 0) {
-				value = uiInfo.characterCount + 2 - 1;
+				value = uiInfo.characterCount + 3 - 1;
 			}
 		} else {
-			if (value >= UI_GetNumBots() + 2) {
+			if (value >= UI_GetNumBots() + 3) {
 				value = 0;
 			} else if (value < 0) {
-				value = UI_GetNumBots() + 2 - 1;
+				value = UI_GetNumBots() + 3 - 1;
 			}
 		}
 
@@ -2533,6 +2541,8 @@
 static qboolean UI_BotName_HandleKey(int flags, float *special, int key) {
 	int select = UI_SelectForKey(key);
 	if (select != 0) {
+		// 0 - Random Bot
+		// 1..NumCharacters - Bot
 		int game = trap_Cvar_VariableValue("g_gametype");
 		int value = uiInfo.botIndex;
 
@@ -2539,16 +2549,16 @@
 		value += select;
 
 		if (game >= GT_TEAM) {
-			if (value >= uiInfo.characterCount) {
+			if (value >= uiInfo.characterCount + 1) {
 				value = 0;
 			} else if (value < 0) {
-				value = uiInfo.characterCount - 1;
+				value = uiInfo.characterCount + 1 - 1;
 			}
 		} else {
-			if (value >= UI_GetNumBots()) {
+			if (value >= UI_GetNumBots() + 1) {
 				value = 0;
 			} else if (value < 0) {
-				value = UI_GetNumBots() - 1;
+				value = UI_GetNumBots() + 1 - 1;
 			}
 		}
 		uiInfo.botIndex = value;
@@ -3196,21 +3206,41 @@
 			trap_Cvar_SetValue("sv_maxClients", clients);
 
 			for (i = 0; i < PLAYERS_PER_TEAM; i++) {
+				// 0 - None
+				// 1 - Human
+				// 2 - Random Bot
+				// 3..NumCharacters - Bot
 				int bot = trap_Cvar_VariableValue( va("ui_blueteam%i", i+1));
 				if (bot > 1) {
+					if (bot == 2) {
+						name = "random";
+					} else if (ui_actualNetGameType.integer >= GT_TEAM) {
+						name = uiInfo.characterList[bot-3].name;
+					} else {
+						name = UI_GetBotNameByNumber(bot-3);
+					}
+
 					if (ui_actualNetGameType.integer >= GT_TEAM) {
-						Com_sprintf( buff, sizeof(buff), "addbot %s %f %s\n", uiInfo.characterList[bot-2].name, skill, "Blue");
+						Com_sprintf( buff, sizeof(buff), "addbot %s %f %s\n", name, skill, "Blue");
 					} else {
-						Com_sprintf( buff, sizeof(buff), "addbot %s %f \n", UI_GetBotNameByNumber(bot-2), skill);
+						Com_sprintf( buff, sizeof(buff), "addbot %s %f\n", name, skill);
 					}
 					trap_Cmd_ExecuteText( EXEC_APPEND, buff );
 				}
 				bot = trap_Cvar_VariableValue( va("ui_redteam%i", i+1));
 				if (bot > 1) {
+					if (bot == 2) {
+						name = "random";
+					} else if (ui_actualNetGameType.integer >= GT_TEAM) {
+						name = uiInfo.characterList[bot-3].name;
+					} else {
+						name = UI_GetBotNameByNumber(bot-3);
+					}
+
 					if (ui_actualNetGameType.integer >= GT_TEAM) {
-						Com_sprintf( buff, sizeof(buff), "addbot %s %f %s\n", uiInfo.characterList[bot-2].name, skill, "Red");
+						Com_sprintf( buff, sizeof(buff), "addbot %s %f %s\n", name, skill, "Red");
 					} else {
-						Com_sprintf( buff, sizeof(buff), "addbot %s %f \n", UI_GetBotNameByNumber(bot-2), skill);
+						Com_sprintf( buff, sizeof(buff), "addbot %s %f\n", name, skill);
 					}
 					trap_Cmd_ExecuteText( EXEC_APPEND, buff );
 				}
@@ -3406,11 +3436,17 @@
 				trap_Cmd_ExecuteText( EXEC_APPEND, va("callteamvote leader %s\n",uiInfo.teamNames[uiInfo.teamIndex]) );
 			}
 		} else if (Q_stricmp(name, "addBot") == 0) {
-			if (trap_Cvar_VariableValue("g_gametype") >= GT_TEAM) {
-				trap_Cmd_ExecuteText( EXEC_APPEND, va("addbot %s %i %s\n", uiInfo.characterList[uiInfo.botIndex].name, uiInfo.skillIndex+1, (uiInfo.redBlue == 0) ? "Red" : "Blue") );
+			// 0 - Random Bot
+			// 1..NumCharacters - Bot
+			if (uiInfo.botIndex == 0) {
+				name = "random";
+			} else if (trap_Cvar_VariableValue("g_gametype") >= GT_TEAM) {
+				name = uiInfo.characterList[uiInfo.botIndex-1].name;
 			} else {
-				trap_Cmd_ExecuteText( EXEC_APPEND, va("addbot %s %i %s\n", UI_GetBotNameByNumber(uiInfo.botIndex), uiInfo.skillIndex+1, (uiInfo.redBlue == 0) ? "Red" : "Blue") );
+				name = UI_GetBotNameByNumber(uiInfo.botIndex-1);
 			}
+
+			trap_Cmd_ExecuteText( EXEC_APPEND, va("addbot %s %i %s\n", name, uiInfo.skillIndex+1, (uiInfo.redBlue == 0) ? "red" : "blue") );
 		} else if (Q_stricmp(name, "addFavorite") == 0) {
 			if (ui_netSource.integer != UIAS_FAVORITES) {
 				char name[MAX_NAME_LENGTH];
